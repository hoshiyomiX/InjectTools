name: Termux Build & Release

on:
  push:
    tags:
      - 'termux-v*.*.*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., termux-v2.3.0)'
        required: true
        default: 'termux-v2.3.0'

env:
  CARGO_TERM_COLOR: always
  CARGO_INCREMENTAL: 0
  RUST_BACKTRACE: 1

permissions:
  contents: write

jobs:
  build-arm64:
    name: Build ARM64
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout triggering branch
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Verify checkout
        run: |
          echo "Current branch: $(git branch --show-current)"
          echo "Current commit: $(git rev-parse HEAD)"
          echo "Git ref: ${{ github.ref }}"
          echo "Git ref name: ${{ github.ref_name }}"
          git log -1 --oneline

      - name: Create build log directory
        run: |
          mkdir -p build-logs
          echo "Build started at $(date -u '+%Y-%m-%d %H:%M:%S UTC')" | tee build-logs/build-aarch64-linux-android.log
          echo "Target: aarch64-linux-android" | tee -a build-logs/build-aarch64-linux-android.log
          echo "Branch: ${{ github.ref_name }}" | tee -a build-logs/build-aarch64-linux-android.log
          echo "Git commit: $(git rev-parse HEAD)" | tee -a build-logs/build-aarch64-linux-android.log
          echo "========================================" | tee -a build-logs/build-aarch64-linux-android.log

      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: aarch64-linux-android

      - name: Cache cargo dependencies (improved strategy)
        uses: actions/cache@v4
        with:
          path: |
            ~/.cargo/registry/index
            ~/.cargo/registry/cache
            ~/.cargo/git/db
          key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}-${{ hashFiles('src/**/*.rs') }}-${{ hashFiles('Cargo.toml') }}
          restore-keys: |
            ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}-
            ${{ runner.os }}-cargo-

      - name: Download Android NDK
        run: |
          echo "üì• Downloading Android NDK r26d..." | tee -a build-logs/build-aarch64-linux-android.log
          wget -q https://dl.google.com/android/repository/android-ndk-r26d-linux.zip 2>&1 | tee -a build-logs/build-aarch64-linux-android.log
          
          echo "üì¶ Extracting NDK..." | tee -a build-logs/build-aarch64-linux-android.log
          unzip -q android-ndk-r26d-linux.zip 2>&1 | tee -a build-logs/build-aarch64-linux-android.log
          
          echo "ANDROID_NDK_HOME=$PWD/android-ndk-r26d" >> $GITHUB_ENV
          echo "‚úÖ NDK ready" | tee -a build-logs/build-aarch64-linux-android.log

      - name: Configure toolchain
        run: |
          NDK_BIN="$ANDROID_NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin"
          
          echo "CC_aarch64_linux_android=${NDK_BIN}/aarch64-linux-android30-clang" >> $GITHUB_ENV
          echo "AR_aarch64_linux_android=${NDK_BIN}/llvm-ar" >> $GITHUB_ENV
          echo "CARGO_TARGET_AARCH64_LINUX_ANDROID_LINKER=${NDK_BIN}/aarch64-linux-android30-clang" >> $GITHUB_ENV
          
          echo "üîß Toolchain configured" | tee -a build-logs/build-aarch64-linux-android.log

      - name: Force clean build
        run: |
          echo "üßπ Forcing complete clean build..." | tee -a build-logs/build-aarch64-linux-android.log
          
          # Clean target directory
          cargo clean 2>&1 | tee -a build-logs/build-aarch64-linux-android.log
          
          # Clean cargo cache untuk project ini specifically
          rm -rf ~/.cargo/registry/cache
          rm -rf ~/.cargo/git/db
          
          # Ensure no leftover target artifacts
          rm -rf target/
          
          echo "‚úÖ Clean complete - guaranteed fresh build" | tee -a build-logs/build-aarch64-linux-android.log

      - name: Build binary
        id: build
        continue-on-error: true
        run: |
          set -o pipefail
          
          echo "üî® Building from source..." | tee -a build-logs/build-aarch64-linux-android.log
          echo "========================================" | tee -a build-logs/build-aarch64-linux-android.log
          
          # Log source state untuk traceability
          echo "üìã Build Context:" | tee -a build-logs/build-aarch64-linux-android.log
          echo "Branch: ${{ github.ref_name }}" | tee -a build-logs/build-aarch64-linux-android.log
          echo "Git commit: $(git rev-parse HEAD)" | tee -a build-logs/build-aarch64-linux-android.log
          echo "Git commit short: $(git rev-parse --short HEAD)" | tee -a build-logs/build-aarch64-linux-android.log
          
          CARGO_VERSION=$(grep '^version' Cargo.toml | sed 's/version = "\(.*\)"/\1/')
          echo "Cargo.toml version: $CARGO_VERSION" | tee -a build-logs/build-aarch64-linux-android.log
          
          # Hash all source files untuk verification
          SOURCES_HASH=$(find src -type f -name '*.rs' -exec sha256sum {} \; | sha256sum | cut -d' ' -f1)
          echo "Source files hash: $SOURCES_HASH" | tee -a build-logs/build-aarch64-linux-android.log
          
          echo "Main menu options count: $(grep -c 'println!("[0-9]' src/main.rs || echo 'N/A')" | tee -a build-logs/build-aarch64-linux-android.log
          echo "========================================" | tee -a build-logs/build-aarch64-linux-android.log
          
          # Build dengan full logging
          BUILD_START=$(date +%s)
          
          if cargo build --release --target aarch64-linux-android 2>&1 | tee -a build-logs/build-aarch64-linux-android.log; then
            BUILD_END=$(date +%s)
            BUILD_DURATION=$((BUILD_END - BUILD_START))
            
            echo "========================================" | tee -a build-logs/build-aarch64-linux-android.log
            echo "Build completed in ${BUILD_DURATION}s" | tee -a build-logs/build-aarch64-linux-android.log
            
            # Verify binary exists
            if [ ! -f target/aarch64-linux-android/release/injecttools ]; then
              echo "‚ùå Build failed - binary not found" | tee -a build-logs/build-aarch64-linux-android.log
              exit 1
            fi
            
            # Verify binary is FRESH (built within last 5 minutes)
            CURRENT_TIME=$(date +%s)
            BINARY_TIME=$(stat -c %Y target/aarch64-linux-android/release/injecttools)
            BINARY_AGE=$((CURRENT_TIME - BINARY_TIME))
            
            echo "üîç Build Verification:" | tee -a build-logs/build-aarch64-linux-android.log
            echo "Current time: $(date -u '+%Y-%m-%d %H:%M:%S UTC') (${CURRENT_TIME})" | tee -a build-logs/build-aarch64-linux-android.log
            echo "Binary mtime: $(date -u -d @${BINARY_TIME} '+%Y-%m-%d %H:%M:%S UTC') (${BINARY_TIME})" | tee -a build-logs/build-aarch64-linux-android.log
            echo "Binary age: ${BINARY_AGE}s" | tee -a build-logs/build-aarch64-linux-android.log
            
            if [ $BINARY_AGE -gt 300 ]; then
              echo "‚ùå ERROR: Binary is STALE (older than 5 minutes)!" | tee -a build-logs/build-aarch64-linux-android.log
              echo "This indicates a cached/old binary was used instead of fresh compilation" | tee -a build-logs/build-aarch64-linux-android.log
              echo "Expected: Binary age < 300s" | tee -a build-logs/build-aarch64-linux-android.log
              echo "Actual: Binary age = ${BINARY_AGE}s" | tee -a build-logs/build-aarch64-linux-android.log
              exit 1
            fi
            
            echo "‚úÖ Binary freshness verified (${BINARY_AGE}s old)" | tee -a build-logs/build-aarch64-linux-android.log
            echo "‚úÖ Build successful" | tee -a build-logs/build-aarch64-linux-android.log
            ls -lh target/aarch64-linux-android/release/injecttools | tee -a build-logs/build-aarch64-linux-android.log
          else
            echo "‚ùå Cargo build failed" | tee -a build-logs/build-aarch64-linux-android.log
            exit 1
          fi

      - name: Strip binary
        if: steps.build.outcome == 'success'
        run: |
          BEFORE=$(stat -c%s target/aarch64-linux-android/release/injecttools)
          echo "Before strip: $(numfmt --to=iec-i --suffix=B $BEFORE)" | tee -a build-logs/build-aarch64-linux-android.log
          
          $ANDROID_NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-strip \
            target/aarch64-linux-android/release/injecttools
          
          AFTER=$(stat -c%s target/aarch64-linux-android/release/injecttools)
          echo "After strip: $(numfmt --to=iec-i --suffix=B $AFTER)" | tee -a build-logs/build-aarch64-linux-android.log
          
          SAVED=$((BEFORE - AFTER))
          echo "Saved: $(numfmt --to=iec-i --suffix=B $SAVED)" | tee -a build-logs/build-aarch64-linux-android.log

      - name: Package
        if: steps.build.outcome == 'success'
        run: |
          cd target/aarch64-linux-android/release
          tar czf ../../../injecttools-termux-arm64.tar.gz injecttools
          cd ../../..
          
          sha256sum injecttools-termux-arm64.tar.gz | tee injecttools-termux-arm64.tar.gz.sha256 | tee -a build-logs/build-aarch64-linux-android.log
          echo "Finished: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" | tee -a build-logs/build-aarch64-linux-android.log

      - name: Finalize build log
        if: always()
        run: |
          echo "========================================" | tee -a build-logs/build-aarch64-linux-android.log
          echo "Build status: ${{ steps.build.outcome }}" | tee -a build-logs/build-aarch64-linux-android.log
          echo "Finished at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" | tee -a build-logs/build-aarch64-linux-android.log

      - name: Commit build log to branch
        if: always()
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          git add build-logs/build-aarch64-linux-android.log
          
          if ! git diff --staged --quiet; then
            git commit -m "Update ARM64 build log - Status: ${{ steps.build.outcome }} [skip ci]"
            git push origin HEAD:${{ github.ref_name }}
          else
            echo "No changes to commit"
          fi

      - name: Upload artifacts
        if: steps.build.outcome == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: injecttools-termux-arm64
          path: |
            injecttools-termux-arm64.tar.gz
            injecttools-termux-arm64.tar.gz.sha256

      - name: Fail job if build failed
        if: steps.build.outcome != 'success'
        run: |
          echo "‚ùå Build failed - check build logs for details"
          exit 1

  build-armv7:
    name: Build ARMv7
    runs-on: ubuntu-latest
    needs: build-arm64
    
    steps:
      - name: Checkout triggering branch
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Verify checkout
        run: |
          echo "Current branch: $(git branch --show-current)"
          echo "Current commit: $(git rev-parse HEAD)"
          echo "Git ref: ${{ github.ref }}"
          echo "Git ref name: ${{ github.ref_name }}"
          git log -1 --oneline

      - name: Create build log directory
        run: |
          mkdir -p build-logs
          echo "Build started at $(date -u '+%Y-%m-%d %H:%M:%S UTC')" | tee build-logs/build-armv7-linux-androideabi.log
          echo "Target: armv7-linux-androideabi" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "Branch: ${{ github.ref_name }}" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "Git commit: $(git rev-parse HEAD)" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "========================================" | tee -a build-logs/build-armv7-linux-androideabi.log

      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: armv7-linux-androideabi

      - name: Cache cargo dependencies (improved strategy)
        uses: actions/cache@v4
        with:
          path: |
            ~/.cargo/registry/index
            ~/.cargo/registry/cache
            ~/.cargo/git/db
          key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}-${{ hashFiles('src/**/*.rs') }}-${{ hashFiles('Cargo.toml') }}
          restore-keys: |
            ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}-
            ${{ runner.os }}-cargo-

      - name: Download Android NDK
        run: |
          echo "üì• Downloading Android NDK r26d..." | tee -a build-logs/build-armv7-linux-androideabi.log
          wget -q https://dl.google.com/android/repository/android-ndk-r26d-linux.zip 2>&1 | tee -a build-logs/build-armv7-linux-androideabi.log
          
          echo "üì¶ Extracting NDK..." | tee -a build-logs/build-armv7-linux-androideabi.log
          unzip -q android-ndk-r26d-linux.zip 2>&1 | tee -a build-logs/build-armv7-linux-androideabi.log
          
          echo "ANDROID_NDK_HOME=$PWD/android-ndk-r26d" >> $GITHUB_ENV
          echo "‚úÖ NDK ready" | tee -a build-logs/build-armv7-linux-androideabi.log

      - name: Configure toolchain
        run: |
          NDK_BIN="$ANDROID_NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin"
          
          echo "CC_armv7_linux_androideabi=${NDK_BIN}/armv7a-linux-androideabi30-clang" >> $GITHUB_ENV
          echo "AR_armv7_linux_androideabi=${NDK_BIN}/llvm-ar" >> $GITHUB_ENV
          echo "CARGO_TARGET_ARMV7_LINUX_ANDROIDEABI_LINKER=${NDK_BIN}/armv7a-linux-androideabi30-clang" >> $GITHUB_ENV
          
          echo "üîß Toolchain configured" | tee -a build-logs/build-armv7-linux-androideabi.log

      - name: Force clean build
        run: |
          echo "üßπ Forcing complete clean build..." | tee -a build-logs/build-armv7-linux-androideabi.log
          
          # Clean target directory
          cargo clean 2>&1 | tee -a build-logs/build-armv7-linux-androideabi.log
          
          # Clean cargo cache untuk project ini specifically
          rm -rf ~/.cargo/registry/cache
          rm -rf ~/.cargo/git/db
          
          # Ensure no leftover target artifacts
          rm -rf target/
          
          echo "‚úÖ Clean complete - guaranteed fresh build" | tee -a build-logs/build-armv7-linux-androideabi.log

      - name: Build binary
        id: build
        continue-on-error: true
        run: |
          set -o pipefail
          
          echo "üî® Building from source..." | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "========================================" | tee -a build-logs/build-armv7-linux-androideabi.log
          
          # Log source state untuk traceability
          echo "üìã Build Context:" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "Branch: ${{ github.ref_name }}" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "Git commit: $(git rev-parse HEAD)" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "Git commit short: $(git rev-parse --short HEAD)" | tee -a build-logs/build-armv7-linux-androideabi.log
          
          CARGO_VERSION=$(grep '^version' Cargo.toml | sed 's/version = "\(.*\)"/\1/')
          echo "Cargo.toml version: $CARGO_VERSION" | tee -a build-logs/build-armv7-linux-androideabi.log
          
          # Hash all source files untuk verification
          SOURCES_HASH=$(find src -type f -name '*.rs' -exec sha256sum {} \; | sha256sum | cut -d' ' -f1)
          echo "Source files hash: $SOURCES_HASH" | tee -a build-logs/build-armv7-linux-androideabi.log
          
          echo "Main menu options count: $(grep -c 'println!("[0-9]' src/main.rs || echo 'N/A')" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "========================================" | tee -a build-logs/build-armv7-linux-androideabi.log
          
          # Build dengan full logging
          BUILD_START=$(date +%s)
          
          if cargo build --release --target armv7-linux-androideabi 2>&1 | tee -a build-logs/build-armv7-linux-androideabi.log; then
            BUILD_END=$(date +%s)
            BUILD_DURATION=$((BUILD_END - BUILD_START))
            
            echo "========================================" | tee -a build-logs/build-armv7-linux-androideabi.log
            echo "Build completed in ${BUILD_DURATION}s" | tee -a build-logs/build-armv7-linux-androideabi.log
            
            # Verify binary exists
            if [ ! -f target/armv7-linux-androideabi/release/injecttools ]; then
              echo "‚ùå Build failed - binary not found" | tee -a build-logs/build-armv7-linux-androideabi.log
              exit 1
            fi
            
            # Verify binary is FRESH (built within last 5 minutes)
            CURRENT_TIME=$(date +%s)
            BINARY_TIME=$(stat -c %Y target/armv7-linux-androideabi/release/injecttools)
            BINARY_AGE=$((CURRENT_TIME - BINARY_TIME))
            
            echo "üîç Build Verification:" | tee -a build-logs/build-armv7-linux-androideabi.log
            echo "Current time: $(date -u '+%Y-%m-%d %H:%M:%S UTC') (${CURRENT_TIME})" | tee -a build-logs/build-armv7-linux-androideabi.log
            echo "Binary mtime: $(date -u -d @${BINARY_TIME} '+%Y-%m-%d %H:%M:%S UTC') (${BINARY_TIME})" | tee -a build-logs/build-armv7-linux-androideabi.log
            echo "Binary age: ${BINARY_AGE}s" | tee -a build-logs/build-armv7-linux-androideabi.log
            
            if [ $BINARY_AGE -gt 300 ]; then
              echo "‚ùå ERROR: Binary is STALE (older than 5 minutes)!" | tee -a build-logs/build-armv7-linux-androideabi.log
              echo "This indicates a cached/old binary was used instead of fresh compilation" | tee -a build-logs/build-armv7-linux-androideabi.log
              echo "Expected: Binary age < 300s" | tee -a build-logs/build-armv7-linux-androideabi.log
              echo "Actual: Binary age = ${BINARY_AGE}s" | tee -a build-logs/build-armv7-linux-androideabi.log
              exit 1
            fi
            
            echo "‚úÖ Binary freshness verified (${BINARY_AGE}s old)" | tee -a build-logs/build-armv7-linux-androideabi.log
            echo "‚úÖ Build successful" | tee -a build-logs/build-armv7-linux-androideabi.log
            ls -lh target/armv7-linux-androideabi/release/injecttools | tee -a build-logs/build-armv7-linux-androideabi.log
          else
            echo "‚ùå Cargo build failed" | tee -a build-logs/build-armv7-linux-androideabi.log
            exit 1
          fi

      - name: Strip binary
        if: steps.build.outcome == 'success'
        run: |
          BEFORE=$(stat -c%s target/armv7-linux-androideabi/release/injecttools)
          echo "Before strip: $(numfmt --to=iec-i --suffix=B $BEFORE)" | tee -a build-logs/build-armv7-linux-androideabi.log
          
          $ANDROID_NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-strip \
            target/armv7-linux-androideabi/release/injecttools
          
          AFTER=$(stat -c%s target/armv7-linux-androideabi/release/injecttools)
          echo "After strip: $(numfmt --to=iec-i --suffix=B $AFTER)" | tee -a build-logs/build-armv7-linux-androideabi.log
          
          SAVED=$((BEFORE - AFTER))
          echo "Saved: $(numfmt --to=iec-i --suffix=B $SAVED)" | tee -a build-logs/build-armv7-linux-androideabi.log

      - name: Package
        if: steps.build.outcome == 'success'
        run: |
          cd target/armv7-linux-androideabi/release
          tar czf ../../../injecttools-termux-armv7.tar.gz injecttools
          cd ../../..
          
          sha256sum injecttools-termux-armv7.tar.gz | tee injecttools-termux-armv7.tar.gz.sha256 | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "Finished: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" | tee -a build-logs/build-armv7-linux-androideabi.log

      - name: Finalize build log
        if: always()
        run: |
          echo "========================================" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "Build status: ${{ steps.build.outcome }}" | tee -a build-logs/build-armv7-linux-androideabi.log
          echo "Finished at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" | tee -a build-logs/build-armv7-linux-androideabi.log

      - name: Commit build log to branch
        if: always()
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          git add build-logs/build-armv7-linux-androideabi.log
          
          if ! git diff --staged --quiet; then
            git commit -m "Update ARMv7 build log - Status: ${{ steps.build.outcome }} [skip ci]"
            git push origin HEAD:${{ github.ref_name }}
          else
            echo "No changes to commit"
          fi

      - name: Upload artifacts
        if: steps.build.outcome == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: injecttools-termux-armv7
          path: |
            injecttools-termux-armv7.tar.gz
            injecttools-termux-armv7.tar.gz.sha256

      - name: Fail job if build failed
        if: steps.build.outcome != 'success'
        run: |
          echo "‚ùå Build failed - check build logs for details"
          exit 1

  create-release:
    name: Create Release
    needs: [build-arm64, build-armv7]
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - uses: actions/checkout@v4
      
      - name: Download artifacts
        uses: actions/download-artifact@v4
        with:
          path: artifacts
      
      - name: Prepare release
        run: |
          mkdir -p release-assets
          find artifacts -name "*.tar.gz" -exec cp {} release-assets/ \;
          find artifacts -name "*.sha256" -exec cp {} release-assets/ \;
          
          cd release-assets
          cat *.sha256 > checksums.txt
          
          echo "üì¶ Release Assets:"
          ls -lh
      
      - name: Get version
        id: version
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "version=${{ github.event.inputs.version }}" >> $GITHUB_OUTPUT
          else
            echo "version=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          fi
      
      - name: Get Cargo version for release notes
        id: cargo_version
        run: |
          CARGO_VERSION=$(grep '^version' Cargo.toml | sed 's/version = "\(.*\)"/\1/')
          echo "cargo_version=$CARGO_VERSION" >> $GITHUB_OUTPUT
      
      - name: Create release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.version.outputs.version }}
          name: InjectTools v${{ steps.cargo_version.outputs.cargo_version }}
          body: |
            # InjectTools v${{ steps.cargo_version.outputs.cargo_version }} - Termux Edition
            
            ü§ñ **Bug Inject Scanner for Cloudflare Subdomains** - High-performance Rust implementation
            
            ## ‚ú® Quick Install
            
            ```bash
            curl -sSL https://raw.githubusercontent.com/hoshiyomiX/InjectTools/main/install.sh | bash
            ```
            
            ## üì¶ Manual Install
            
            **Check architecture:**
            ```bash
            uname -m
            # aarch64 = ARM64, armv7l = ARMv7
            ```
            
            **ARM64:**
            ```bash
            wget https://github.com/hoshiyomiX/InjectTools/releases/download/${{ steps.version.outputs.version }}/injecttools-termux-arm64.tar.gz
            tar xzf injecttools-termux-arm64.tar.gz && mv injecttools $PREFIX/bin/ && chmod +x $PREFIX/bin/injecttools
            ```
            
            **ARMv7:**
            ```bash
            wget https://github.com/hoshiyomiX/InjectTools/releases/download/${{ steps.version.outputs.version }}/injecttools-termux-armv7.tar.gz
            tar xzf injecttools-termux-armv7.tar.gz && mv injecttools $PREFIX/bin/ && chmod +x $PREFIX/bin/injecttools
            ```
            
            ## üöÄ Features v${{ steps.cargo_version.outputs.cargo_version }}
            
            - ‚ö° Async scanning
            - üåê crt.sh integration
            - üì¶ Batch testing
            - üìÑ Export/view results
            - ‚òÅÔ∏è Cloudflare detection
            - ‚èπÔ∏è Ctrl+C handling
            
            ## üîê Checksums
            
            ```
            $(cat release-assets/checksums.txt)
            ```
            
            ## üìù Build Info
            
            - **Branch:** ${{ github.ref_name }}
            - **Commit:** ${{ github.sha }}
            - **Built:** $(date -u '+%Y-%m-%d %H:%M:%S UTC')
            
            ---
            
            **By:** [@hoshiyomi_id](https://t.me/hoshiyomi_id) | **License:** MIT
          files: release-assets/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
